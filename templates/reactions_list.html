{% extends 'reactions.html' %}
{% load performed_rxn_delete_form %}
{% load performed_rxn_invalidate_form %}

{% block additional_css %}
<link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}css/reactionsList.css" />
{% endblock %}

{% block content %}
<h1 class="bannerText">Reactions Database</h1>  
{% if user.is_authenticated %}
    {% include "lab_form.html" %}
  <div class="downloads">
    <h1 class="downloads">Downloads</h1>
    <ul class="downloads">
      <li><a href="{% url request.resolver_match.url_name '.csv' %}?{{ request.GET.urlencode }}">csv</a></li>
      {% if user.is_authenticated %}<li><a href="{% url request.resolver_match.url_name '.csv' %}?expanded=&{{ request.GET.urlencode }}">Expanded csv</a></li>{% endif %}
      <li><a href="{% url request.resolver_match.url_name '.arff' %}?{{ request.GET.urlencode }}">arff</a></li>
      {% if user.is_authenticated %}<li><a href="{% url request.resolver_match.url_name '.arff' %}?expanded=&{{ request.GET.urlencode }}">Expanded arff</a></li>{% endif %}
    </ul>
  </div>

{% endif %}
{% if reactions|length > 0 %}

<table class="reactions-list">
  {% for reaction in reactions %}
  <div class="reaction" {% if reaction.valid %} style="border: 5px solid #376737" {% else %} style="border: 5px solid #8b2c27" {% endif %}>
    {% comment %}need to change color of main div with {{ reaction.valid }}{% endcomment %} 
    <div class="first_name">Entered by: {{ reaction.user.first_name }} {{ reaction.user.last_name }}</div>
    {% if reaction.performedBy != None %}
      <div class="performed_by">Performed by: {{ reaction.performedBy }}</div>
    {% endif %}
    <div class="reference">Reference ID: {{ reaction.reference }}</div> 
    <div class="quantities">
	<p>Quantities:</p>
      {% for quantity in reaction.compoundquantity_set.all %}
	<ul>
          <li>{{ quantity.role.label }}</li>
          <li>{{ quantity.compound.name }}</li>
          <li>{{ quantity.amount }} mmoles</li>
        </ul>
      {% endfor %}
    </div>
    {% if reaction.performedDateTime != None %}
      <div class="performed_date">Performed Date: {{ reaction.performedDateTime }}</div>
    {% endif %}
    <div class="inserted_date">Inserted Date: {{ reaction.insertedDateTime }}</div>
    {% if reaction.notes != "" %}
      <div class="notes">Notes: {{ reaction.notes }}</div>
    {% endif %}
    <div class="input_wrapper">
    {% if user.is_authenticated %}
      {% if reaction.labGroup in user.labgroup_set.all %}
    	  <form action="{% url 'editReaction' reaction.pk %}">
            {% csrf_token %}
            {% performed_rxn_delete_form reaction %}
            <input type="Submit" value="edit" />
          </form> 
	  {% if not reaction.datasetrelation_set.exists %}
    	  <form action="{% url 'deleteReaction' %}" method="post">
            {% csrf_token %}
            {% performed_rxn_delete_form reaction %}
            <input class="delete" type="Submit" value="delete" />
          </form> 
        {% else %}
          <form action="{% url 'invalidateReaction' %}" method="post">
            {% csrf_token %}
            {% performed_rxn_invalidate_form reaction %}
            <input type="Submit" value="invalidate" />
          </form>
        {% endif %}
      {% endif %}
     </div>
    {% endif %}
  </div>
  </div>
  {% endfor %}
</table>
<div>

{% comment %}
figure out current page
style it differently, give it an active id
-- for now, just have a small form that gives text input to specify a page
-- or hide all of them and only put the next page
{% endcomment %}
<h3>Page</h3>
<ol id="page_list" class="pagination">
    {% for x in paginator.page_range %}
        <li><a href="?page={{ x }}">{{ x }}</a></li>
    {% endfor %}
</ol>
</div>
{% else %}
<p>There are currently no reactions to display</p>
{% endif %}

{% endblock %}


{% block additional_js %}

<script type="text/javascript">

</script>

{% endblock %}


